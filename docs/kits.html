<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RouterHaus Â· Kits</title>
  <meta name="description" content="Filter and compare the best router kits for apartments, homes, and offices." />
  <meta name="color-scheme" content="light dark" />
  <link rel="preload" href="kits.json" as="fetch" type="application/json" />

  <!-- Theme sync to system with no FOUC -->
  <script>
    (() => {
      const root = document.documentElement;
      const media = matchMedia('(prefers-color-scheme: dark)');
      const apply = () => root.setAttribute('data-theme', media.matches ? 'dark' : 'light');
      apply(); 
      media.addEventListener('change', apply);
    })();
  </script>

  <!-- Enhanced Styles -->
  <link rel="stylesheet" href="main.css" />
  <link rel="stylesheet" href="assets/css/kits.css" />
</head>
<body>
  <!-- Ambient background system -->
  <div class="ambient-bg" aria-hidden="true">
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-orb orb-3"></div>
  </div>

  <!-- Page progress indicator -->
  <div class="page-progress-ring" aria-hidden="true">
    <svg class="progress-ring-svg">
      <circle class="progress-ring-circle" cx="20" cy="20" r="18" 
              style="stroke-dasharray: 113; stroke-dashoffset: 113;"></circle>
    </svg>
    <span class="progress-percentage">0%</span>
  </div>

  <!-- Header partial mounts BEFORE main to avoid CLS -->
  <div id="header-placeholder" data-partial="header.html"></div>

  <main class="container kits-layout" id="main-content">
    <!-- Desktop filter rail -->
    <aside id="filtersAside" class="filters-rail glass" aria-label="Filters" role="complementary">
      <div class="filters-header">
        <h2>
          <i class="icon-filter" aria-hidden="true">âš™</i>
          Filters
        </h2>
        <small id="matchCount" aria-live="polite" class="match-count">Loading...</small>
      </div>

      <div class="facet-toolbar" role="group" aria-label="Facet tools">
        <button type="button" id="expandAll" class="btn small">
          <i class="icon" aria-hidden="true">â¬‡</i>
          Expand all
        </button>
        <button type="button" id="collapseAll" class="btn small">
          <i class="icon" aria-hidden="true">â¬†</i>
          Collapse all
        </button>
        <button type="button" id="clearAllFacets" class="btn small ghost">
          <i class="icon" aria-hidden="true">âœ•</i>
          Clear all
        </button>
      </div>

      <form id="filtersForm" class="filters-form" aria-describedby="matchCount">
        <!-- Quick Picks -->
        <section class="facet quick-picks-section" data-facet="quick" aria-labelledby="quick-picks-h">
          <div class="facet-head">
            <h3 id="quick-picks-h">
              <i class="icon" aria-hidden="true">âš¡</i>
              Quick Picks
            </h3>
            <button type="button" class="btn tiny facet-clear" data-clear="quick">Clear</button>
          </div>
          <div class="chips" id="quickChips" role="group" aria-label="Quick picks">
            <button type="button" class="chip" data-qpick="families">
              <i class="icon" aria-hidden="true">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</i>
              Best for Families
            </button>
            <button type="button" class="chip" data-qpick="budget">
              <i class="icon" aria-hidden="true">ğŸ’°</i>
              Budget-Friendly
            </button>
            <button type="button" class="chip" data-qpick="gaming">
              <i class="icon" aria-hidden="true">ğŸ®</i>
              Gaming Ready
            </button>
            <button type="button" class="chip" data-qpick="mesh">
              <i class="icon" aria-hidden="true">ğŸ•¸</i>
              Whole-Home Wi-Fi
            </button>
            <button type="button" class="chip" data-qpick="fast">
              <i class="icon" aria-hidden="true">âš¡</i>
              Fast Internet
            </button>
            <button type="button" class="chip" data-qpick="wfh">
              <i class="icon" aria-hidden="true">ğŸ </i>
              Work from Home
            </button>
          </div>
        </section>

        <div class="divider-modern" aria-hidden="true"></div>

        <!-- Brand Filter -->
        <details class="facet" data-facet="brand" open>
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ¢</i>
              Brand
            </span>
            <span class="facet-meta">
              <span class="badge count" id="badge-brand">0</span>
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="brand">Clear</button>
          </div>
          <div class="options" id="facet-brand"></div>
        </details>

        <!-- Wi-Fi Generation -->
        <details class="facet" data-facet="wifi" open>
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ“¶</i>
              Wi-Fi Speed & Tech
            </span>
            <span class="facet-meta">
              <span class="badge count" id="badge-wifiGen">0</span>
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="wifi">Clear</button>
          </div>
          <div class="options two-cols" id="facet-wifiGen"></div>
        </details>

        <!-- Wi-Fi Bands -->
        <details class="facet" data-facet="bands">
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ“¡</i>
              Wi-Fi Bands
            </span>
            <span class="facet-meta">
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="bands">Clear</button>
          </div>
          <div class="options two-cols" id="facet-wifiBands"></div>
        </details>

        <!-- Mesh Coverage -->
        <details class="facet" data-facet="mesh" open>
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸŒ</i>
              Whole-Home Coverage (Mesh)
            </span>
            <span class="facet-meta">
              <span class="badge count" id="badge-meshReady">0</span>
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="mesh">Clear</button>
          </div>
          <div class="options" id="facet-meshReady"></div>
          <div class="options" id="facet-meshEco"></div>
        </details>

        <!-- Internet Speed Support -->
        <details class="facet" data-facet="wan">
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸš€</i>
              Internet Speed Support
            </span>
            <span class="facet-meta">
              <span class="badge count" id="badge-wanTier">0</span>
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="wan">Clear</button>
          </div>
          <div class="options two-cols" id="facet-wanTier"></div>
        </details>

        <!-- LAN Ports -->
        <details class="facet" data-facet="lanCount">
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ”Œ</i>
              Wired Ports (LAN)
            </span>
            <span class="facet-meta">
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="lanCount">Clear</button>
          </div>
          <div class="options two-cols" id="facet-lanCount"></div>
        </details>

        <!-- Multi-Gig LAN -->
        <details class="facet" data-facet="multiGigLan">
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">âš¡</i>
              Super-Fast Wired Ports
            </span>
            <span class="facet-meta">
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="multiGigLan">Clear</button>
          </div>
          <div class="options two-cols" id="facet-multiGigLan"></div>
        </details>

        <!-- USB Ports -->
        <details class="facet" data-facet="usb">
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ”Œ</i>
              USB Ports
            </span>
            <span class="facet-meta">
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="usb">Clear</button>
          </div>
          <div class="options two-cols" id="facet-usb"></div>
        </details>

        <!-- Home Size Coverage -->
        <details class="facet" data-facet="coverage" open>
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ </i>
              Home Size Coverage
            </span>
            <span class="facet-meta">
              <span class="badge count" id="badge-coverageBucket">0</span>
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="coverage">Clear</button>
          </div>
          <div class="options two-cols" id="facet-coverageBucket"></div>
        </details>

        <!-- Device Load -->
        <details class="facet" data-facet="device" open>
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ“±</i>
              Number of Devices on Wi-Fi
            </span>
            <span class="facet-meta">
              <span class="badge count" id="badge-deviceLoad">0</span>
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="device">Clear</button>
          </div>
          <div class="options two-cols" id="facet-deviceLoad"></div>
        </details>

        <!-- Primary Use -->
        <details class="facet" data-facet="use" open>
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ¯</i>
              Main Use
            </span>
            <span class="facet-meta">
              <span class="badge count" id="badge-primaryUse">0</span>
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="use">Clear</button>
          </div>
          <div class="options" id="facet-primaryUse"></div>
        </details>

        <!-- Internet Type -->
        <details class="facet" data-facet="access">
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸŒ</i>
              Internet Type
            </span>
            <span class="facet-meta">
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="access">Clear</button>
          </div>
          <div class="options two-cols" id="facet-access"></div>
        </details>

        <!-- Price Range -->
        <details class="facet" data-facet="price">
          <summary>
            <span class="facet-title">
              <i class="icon" aria-hidden="true">ğŸ’°</i>
              Price Range
            </span>
            <span class="facet-meta">
              <span class="badge count" id="badge-priceBucket">0</span>
              <span class="chev" aria-hidden="true">â–¾</span>
            </span>
          </summary>
          <div class="facet-controls">
            <button type="button" class="btn tiny facet-clear" data-clear="price">Clear</button>
          </div>
          <div class="options two-cols" id="facet-priceBucket"></div>
        </details>

        <!-- Compare Panel (desktop) -->
        <section id="comparePanel" class="facet compare-section" data-facet="compare" aria-labelledby="compare-h">
          <div class="facet-head">
            <h3 id="compare-h">
              <i class="icon" aria-hidden="true">âš–</i>
              Compare
            </h3>
            <button id="clearCompare" class="btn tiny ghost" type="button">Clear</button>
          </div>
          <div id="compareItemsPanel" class="compare-items"></div>
        </section>
      </form>
    </aside>

    <!-- Mobile filter FAB & drawer -->
    <button id="filtersFab" class="fab" aria-controls="filtersDrawer" aria-expanded="false">
      <i class="icon" aria-hidden="true">âš™</i>
      Filters 
      <span id="activeCount" class="badge count">0</span>
    </button>

    <div id="filtersDrawer" class="drawer" aria-hidden="true" aria-labelledby="drawerTitle" role="dialog">
      <div class="drawer-panel glass">
        <div class="drawer-header">
          <h2 id="drawerTitle">
            <i class="modal-icon" aria-hidden="true">âš™</i>
            Filters
          </h2>
          <button class="modal-close" data-close-drawer aria-label="Close filters">âœ•</button>
        </div>
        <div class="drawer-body">
          <div id="drawerFormMount"></div>
        </div>
        <div class="drawer-footer">
          <button class="btn ghost" data-close-drawer>Cancel</button>
          <button id="applyDrawer" class="btn primary">Apply Filters</button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <section class="content" aria-live="polite" role="main">
      <!-- Enhanced search header -->
      <header class="page-header">
        <div class="command-bar glass" role="region" aria-label="Search and actions">
          <div class="search-container">
            <div class="search-wrapper">
              <i class="search-icon" aria-hidden="true">ğŸ”</i>
              <input type="text" id="searchInput" 
                     placeholder="Search by brand, model, or feature..." 
                     aria-label="Search routers"
                     autocomplete="off">
            </div>
            <button id="searchBtn" class="btn primary" type="button" aria-label="Run search">
              <i class="icon" aria-hidden="true">ğŸ”</i>
              Search
            </button>
            <button id="openQuiz" class="btn ghost" type="button">
              <i class="icon" aria-hidden="true">ğŸ§­</i>
              Find My Router
            </button>
          </div>
        </div>
      </header>

      <!-- Active filters chips -->
      <div id="activeChips" class="active-chips" role="list" aria-label="Active filters"></div>

      <!-- Enhanced toolbar -->
      <div class="toolbar glass" role="region" aria-label="Results toolbar">
        <div class="toolbar-group">
          <label class="sort">
            <i class="icon" aria-hidden="true">ğŸ“Š</i>
            <span>Sort</span>
            <select id="sortSelect" aria-label="Sort results">
              <option value="relevance">Relevance</option>
              <option value="wifi-desc">Wi-Fi Gen (Latest)</option>
              <option value="price-asc">Price (Low to High)</option>
              <option value="price-desc">Price (High to Low)</option>
              <option value="coverage-desc">Coverage (Largest)</option>
              <option value="wan-desc">Speed Support</option>
              <option value="reviews-desc">Best Reviewed</option>
            </select>
          </label>

          <label class="pagesize">
            <i class="icon" aria-hidden="true">ğŸ“„</i>
            <span>Per page</span>
            <select id="pageSizeSelect" aria-label="Results per page">
              <option value="12" selected>12</option>
              <option value="24">24</option>
              <option value="48">48</option>
            </select>
          </label>
        </div>

        <div class="toolbar-group">
          <label class="toggle">
            <input type="checkbox" id="toggleRecos" checked />
            <span class="toggle-slider"></span>
            <span>Show recommendations</span>
          </label>

          <button id="openFiltersHeader" class="btn glass" type="button">
            <i class="icon" aria-hidden="true">âš™</i>
            Filters
          </button>
        </div>
      </div>

      <!-- Enhanced recommendations section -->
      <section id="recommendations" class="modern-recommendations" aria-live="polite">
        <div class="modern-section-head">
          <h2>
            <i aria-hidden="true">â­</i>
            Recommended for you
          </h2>
          <small id="recoNote" class="reco-note">Based on popular choices</small>
        </div>
        <div id="recoGrid" class="product-grid"></div>
      </section>

      <!-- Pagination Top -->
      <nav id="paginationTop" class="pagination" aria-label="Pagination top"></nav>

      <!-- Results section -->
      <section class="results" aria-label="Search results">
        <div id="kitsStatus" class="sr-only" role="status" aria-live="polite">Loading kitsâ€¦</div>
        <div id="kitsError" class="hide" role="alert"></div>

        <!-- Enhanced skeleton loader -->
        <div id="skeletonGrid" class="product-grid skeletons" aria-hidden="true"></div>

        <!-- Real results grid -->
        <div id="kitResults" class="product-grid" aria-busy="false"></div>

        <!-- Enhanced empty state -->
        <div id="emptyState" class="empty-modern hide" role="note" aria-live="polite">
          <div class="empty-icon">ğŸ”</div>
          <h3>No routers match your filters</h3>
          <p>Try adjusting your filters or explore these popular options:</p>
          <div class="chips" id="emptyQuickChips" role="group" aria-label="Quick picks (empty results)">
            <button type="button" class="chip" data-qpick="families">
              <i class="icon" aria-hidden="true">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</i>
              Best for Families
            </button>
            <button type="button" class="chip" data-qpick="budget">
              <i class="icon" aria-hidden="true">ğŸ’°</i>
              Budget-Friendly
            </button>
            <button type="button" class="chip" data-qpick="gaming">
              <i class="icon" aria-hidden="true">ğŸ®</i>
              Gaming Ready
            </button>
            <button type="button" class="chip" data-qpick="mesh">
              <i class="icon" aria-hidden="true">ğŸ•¸</i>
              Whole-Home Wi-Fi
            </button>
            <button type="button" class="chip" data-qpick="fast">
              <i class="icon" aria-hidden="true">âš¡</i>
              Fast Internet
            </button>
            <button type="button" class="chip" data-qpick="wfh">
              <i class="icon" aria-hidden="true">ğŸ </i>
              Work from Home
            </button>
          </div>
        </div>
      </section>

      <!-- Pagination Bottom -->
      <nav id="paginationBottom" class="pagination" aria-label="Pagination bottom"></nav>
    </section>
  </main>

  <!-- Sticky compare trigger -->
  <button id="compareSticky" class="compare-sticky" hidden aria-controls="compareDrawer">
    <i class="icon" aria-hidden="true">âš–</i>
    Compare (<span id="compareCount">0</span>)
  </button>

  <!-- Enhanced compare drawer -->
  <aside id="compareDrawer" class="compare glass" aria-live="polite" hidden role="dialog" aria-label="Compare routers">
    <div class="compare-header">
      <strong>
        <i class="icon" aria-hidden="true">âš–</i>
        Compare Routers
      </strong>
      <button id="clearCompareMobile" class="btn small ghost" type="button">Clear All</button>
    </div>
    <div id="compareItems" class="compare-items"></div>
  </aside>

  <!-- Enhanced Quiz Modal -->
  <dialog id="quizModal" class="modal" aria-labelledby="quizTitle" aria-modal="true">
    <div class="modal-content">
      <header class="modal-header">
        <div class="modal-title-group">
          <i class="modal-icon" aria-hidden="true">ğŸ§­</i>
          <h2 id="quizTitle">Find Your Perfect Router</h2>
        </div>
        <button type="button" class="modal-close" aria-label="Close quiz">âœ•</button>
      </header>

      <form id="quizForm" class="quiz-body">
        <div class="quiz-progress">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <span class="progress-text">Step <span id="quizStep">1</span> of 7</span>
        </div>

        <!-- Home Environment -->
        <fieldset class="q-group">
          <legend>
            <i class="icon" aria-hidden="true">ğŸ </i>
            What's your home like?
          </legend>
          <label>
            <span>Home size</span>
            <select id="qCoverage" required>
              <option value="">Select your home size...</option>
              <option value="Apartment/Small">Apartment or Small Home (studio, 1-bed, under 1,800 sq ft)</option>
              <option value="2â€“3 Bedroom">Medium Home (2-3 bedrooms, up to 3,200 sq ft)</option>
              <option value="Large/Multi-floor">Large or Multi-Floor Home (over 3,200 sq ft)</option>
              <option value="">I'm not sure â€“ suggest based on other answers</option>
            </select>
          </label>
          <p id="meshHint" class="hint" aria-live="polite">ğŸ’¡ For larger homes, we recommend mesh systems for seamless coverage.</p>
        </fieldset>

        <!-- Device Load -->
        <fieldset class="q-group">
          <legend>
            <i class="icon" aria-hidden="true">ğŸ“±</i>
            How many devices connect to your Wi-Fi?
          </legend>
          <label>
            <span>Number of devices</span>
            <select id="qDevices" required>
              <option value="">Select device count...</option>
              <option value="1â€“5">1-5 devices (just basics, like a phone and laptop)</option>
              <option value="6â€“15">6-15 devices (family with phones, TVs, and smart devices)</option>
              <option value="16â€“30">16-30 devices (busy home with streaming and gaming)</option>
              <option value="31â€“60">31-60 devices (smart home with cameras, lights, etc.)</option>
              <option value="61â€“100">61-100 devices (lots of gadgets, like in an office)</option>
              <option value="100+">100+ devices (heavy use, pros or big households)</option>
              <option value="">I'm not sure â€“ suggest average</option>
            </select>
          </label>
        </fieldset>

        <!-- Primary Use -->
        <fieldset class="q-group">
          <legend>
            <i class="icon" aria-hidden="true">ğŸ¯</i>
            What do you use Wi-Fi for most?
          </legend>
          <label>
            <span>Main use</span>
            <select id="qUse" required>
              <option value="">Select primary use...</option>
              <option value="All-Purpose">Everyday Use (browsing, email, social media)</option>
              <option value="Gaming">Gaming (online games, low latency needed)</option>
              <option value="Work-From-Home">Work from Home (video calls, file sharing)</option>
              <option value="Smart-Home">Smart Home (lights, thermostats, cameras)</option>
              <option value="Family Streaming">Family Streaming (Netflix, YouTube on multiple TVs)</option>
              <option value="Prosumer">Advanced/Professional (high-speed downloads, servers)</option>
              <option value="">I'm not sure â€“ mix of everything</option>
            </select>
          </label>
        </fieldset>

        <!-- Internet Access Type -->
        <fieldset class="q-group">
          <legend>
            <i class="icon" aria-hidden="true">ğŸŒ</i>
            What type of internet do you have?
          </legend>
          <label>
            <span>Internet type</span>
            <select id="qAccess">
              <option value="">No preference / I'm not sure</option>
              <option value="Cable">Cable Internet (most common, like Xfinity, Spectrum)</option>
              <option value="Fiber">Fiber Internet (super fast, like Google Fiber, Verizon FiOS)</option>
              <option value="FixedWireless5G">5G Wireless Internet (home internet via cell towers)</option>
              <option value="Satellite">Satellite Internet (rural areas, like Starlink, HughesNet)</option>
              <option value="DSL">DSL (older phone line internet)</option>
            </select>
          </label>
        </fieldset>

        <!-- Internet Speed -->
        <fieldset class="q-group">
          <legend>
            <i class="icon" aria-hidden="true">ğŸš€</i>
            Your Internet Plan Speed
          </legend>
          <div class="speed-grid" role="group" aria-label="Internet speed">
            <label class="radio-pill">
              <input type="radio" name="qSpeedLabel" value="â‰¤1G">
              <span>Basic (up to 1 Gbps)</span>
            </label>
            <label class="radio-pill">
              <input type="radio" name="qSpeedLabel" value="2.5G">
              <span>Medium (2.5 Gbps)</span>
            </label>
            <label class="radio-pill">
              <input type="radio" name="qSpeedLabel" value="5G">
              <span>High (5 Gbps)</span>
            </label>
            <label class="radio-pill">
              <input type="radio" name="qSpeedLabel" value="10G">
              <span>Ultra (10+ Gbps)</span>
            </label>
            <label class="radio-pill">
              <input type="radio" name="qSpeedLabel" value="">
              <span>I'm not sure</span>
            </label>
          </div>
        </fieldset>

        <!-- Mesh Preference -->
        <fieldset class="q-group">
          <legend>
            <i class="icon" aria-hidden="true">ğŸ•¸</i>
            Do you want whole-home mesh coverage?
          </legend>
          <div class="mesh-row">
            <label class="auto">
              <input type="checkbox" id="qMeshAuto" checked>
              <span>Auto decide for me (recommended)</span>
            </label>
          </div>
          <div class="mesh-row">
            <label class="radio-pill">
              <input type="radio" name="qMesh" value="" checked>
              <span>No preference</span>
            </label>
            <label class="radio-pill">
              <input type="radio" name="qMesh" value="yes">
              <span>Require mesh system</span>
            </label>
            <label class="radio-pill">
              <input type="radio" name="qMesh" value="no">
              <span>Single router only</span>
            </label>
          </div>
        </fieldset>

        <!-- Budget -->
        <fieldset class="q-group">
          <legend>
            <i class="icon" aria-hidden="true">ğŸ’°</i>
            What's your budget?
          </legend>
          <label>
            <span>Price range</span>
            <select id="qPrice">
              <option value="">No preference / Show all</option>
              <option value="<150">Budget (Under $150)</option>
              <option value="150â€“299">Mid-range ($150-299)</option>
              <option value="300â€“599">Premium ($300-599)</option>
              <option value="600+">High-end ($600+)</option>
            </select>
          </label>
        </fieldset>
      </form>

      <footer class="modal-actions">
        <button type="button" class="btn ghost" id="quizCancel">Cancel</button>
        <button type="submit" class="btn primary" form="quizForm">
          <i class="icon" aria-hidden="true">âœ¨</i>
          Show My Recommendations
        </button>
      </footer>
    </div>
  </dialog>

  <!-- Enhanced card template -->
  <template id="cardTpl">
    <article class="product glass" data-id="" tabindex="0" role="article">
      <div class="product-media">
        <img loading="lazy" alt="" src="" onerror="this.style.display='none'">
        <div class="product-badges">
          <span class="badge-wifi" style="display: none;">Wi-Fi 7</span>
          <span class="badge-recommended" style="display: none;">Recommended</span>
        </div>
        <div class="product-hover-overlay">
          <div class="quick-actions">
            <button class="quick-btn" title="Quick view" aria-label="Quick view">ğŸ‘</button>
            <button class="quick-btn compare-btn" title="Compare" aria-label="Add to compare">âš–</button>
            <button class="quick-btn" title="Share" aria-label="Share">ğŸ“¤</button>
          </div>
        </div>
      </div>
      <header class="product-header">
        <h4 class="title"></h4>
        <div class="chips line"></div>
      </header>
      <ul class="specs" role="list"></ul>
      <div class="priceRow">
        <strong class="price" aria-label="Price"></strong>
        <div class="ctaRow">
          <a class="btn small primary" target="_blank" rel="noopener" aria-label="Buy now">
            <i class="icon" aria-hidden="true">ğŸ›’</i>
            Buy
          </a>
          <button class="icon-btn compare-btn" title="Compare" type="button" aria-pressed="false" aria-label="Add to compare">
            <i class="icon" aria-hidden="true">âš–</i>
          </button>
        </div>
      </div>
    </article>
  </template>

  <!-- Enhanced skeleton template -->
  <template id="skeletonTpl">
    <article class="product glass skeleton" aria-hidden="true">
      <div class="product-media shimmer"></div>
      <header class="product-header">
        <div class="title shimmer" style="height: 1.5em; width: 80%;"></div>
        <div class="chips line">
          <div class="chip shimmer" style="width: 60px; height: 24px;"></div>
          <div class="chip shimmer" style="width: 80px; height: 24px;"></div>
        </div>
      </header>
      <ul class="specs">
        <li class="shimmer" style="height: 1.2em; width: 90%;"></li>
        <li class="shimmer" style="height: 1.2em; width: 75%;"></li>
        <li class="shimmer" style="height: 1.2em; width: 85%;"></li>
      </ul>
      <div class="priceRow">
        <div class="price shimmer" style="width: 80px; height: 1.5em;"></div>
        <div class="ctaRow">
          <span class="btn small shimmer" style="width: 60px; height: 36px;"></span>
          <span class="icon-btn shimmer" style="width: 40px; height: 36px;"></span>
        </div>
      </div>
    </article>
  </template>

  <!-- Footer partial -->
  <div id="footer-placeholder" data-partial="footer.html"></div>

  <!-- Configuration -->
  <script>
    window.RH_CONFIG = {
      jsonUrl: 'kits.json',
      enableRecos: true,
      enableAnimations: true,
      enableAnalytics: false
    };
  </script>

  <!-- Core scripts -->
  <script src="scripts.js" defer></script>
  <script type="module" src="assets/js/kits.js"></script>
  <script type="module" src="assets/js/quiz-modal.js"></script>

  <!-- Enhanced Quick Pick functionality -->
  <script>
    (function initQuickPicks() {
      // Enhanced quick pick mappings with better UX
      const QUICK_PICK_MAP = {
        families: { 
          use: 'Family Streaming', 
          device: '16â€“30',
          coverage: '2â€“3 Bedroom',
          mesh: 'Mesh-ready'
        },
        budget: { 
          price: '<150',
          coverage: 'Apartment/Small'
        },
        gaming: { 
          use: 'Gaming', 
          wan: '2.5G',
          wifi: '7'
        },
        mesh: { 
          mesh: 'Mesh-ready',
          coverage: 'Large/Multi-floor'
        },
        fast: { 
          wifi: '7',
          wan: '5G'
        },
        wfh: { 
          use: 'Work-From-Home',
          device: '6â€“15',
          wifi: '6E'
        }
      };

      function applyQuickPick(key) {
        const spec = QUICK_PICK_MAP[key];
        if (!spec) return;

        // Enhanced URL state management
        const qs = new URLSearchParams(location.search);
        
        // Clear conflicting filters for better UX
        Object.keys(spec).forEach(k => qs.delete(k));
        
        // Apply new filters
        Object.entries(spec).forEach(([facet, value]) => {
          qs.set(facet, value);
        });

        // Reset pagination and ensure recommendations are shown
        qs.delete('page');
        qs.set('recos', '1');

        // Smooth navigation with loading state
        const btn = document.querySelector(`[data-qpick="${key}"]`);
        if (btn) {
          btn.style.opacity = '0.6';
          btn.style.pointerEvents = 'none';
        }

        // Navigate with enhanced UX
        location.search = qs.toString();
      }

      // Enhanced event delegation with better feedback
      document.addEventListener('click', (e) => {
        const btn = e.target.closest('[data-qpick]');
        if (!btn) return;
        
        e.preventDefault();
        
        // Visual feedback
        btn.classList.add('loading');
        
        // Apply the quick pick
        applyQuickPick(btn.dataset.qpick);
      });

      // Enhanced keyboard support
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          const btn = e.target.closest('[data-qpick]');
          if (btn) {
            e.preventDefault();
            btn.click();
          }
        }
      });
    })();

    // Enhanced scroll progress indicator
    (function initScrollProgress() {
      const progressRing = document.querySelector('.page-progress-ring');
      const circle = progressRing?.querySelector('.progress-ring-circle');
      const percentage = progressRing?.querySelector('.progress-percentage');
      
      if (!circle || !percentage) return;

      const circumference = 2 * Math.PI * 18; // radius = 18
      circle.style.strokeDasharray = circumference;

      function updateProgress() {
        const scrolled = window.scrollY;
        const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
        const progress = Math.min(scrolled / maxScroll, 1);
        
        const offset = circumference - (progress * circumference);
        circle.style.strokeDashoffset = offset;
        percentage.textContent = Math.round(progress * 100) + '%';
        
        progressRing.style.opacity = progress > 0.1 ? '1' : '0';
      }

      let ticking = false;
      function handleScroll() {
        if (!ticking) {
          requestAnimationFrame(updateProgress);
          ticking = true;
          setTimeout(() => ticking = false, 10);
        }
      }

      window.addEventListener('scroll', handleScroll, { passive: true });
      updateProgress(); // Initial call
    })();

    // Enhanced intersection observer for reveal animations
    (function initRevealAnimations() {
      if (!window.IntersectionObserver) return;
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');
            observer.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.1,
        rootMargin: '50px'
      });

      // Observe elements as they're added
      const observeReveals = () => {
        document.querySelectorAll('.product:not(.in-view)').forEach(el => {
          el.classList.add('reveal');
          observer.observe(el);
        });
      };

      // Initial observation and re-observe on content changes
      observeReveals();
      
      // Watch for new content
      const mutationObserver = new MutationObserver(() => {
        setTimeout(observeReveals, 100);
      });
      
      mutationObserver.observe(document.getElementById('kitResults'), {
        childList: true,
        subtree: true
      });
    })();

    // Enhanced accessibility improvements
    (function initAccessibility() {
      // Skip to main content link
      const skipLink = document.createElement('a');
      skipLink.href = '#main-content';
      skipLink.textContent = 'Skip to main content';
      skipLink.className = 'sr-only';
      skipLink.style.position = 'fixed';
      skipLink.style.top = '10px';
      skipLink.style.left = '10px';
      skipLink.style.zIndex = '9999';
      skipLink.addEventListener('focus', () => {
        skipLink.classList.remove('sr-only');
      });
      skipLink.addEventListener('blur', () => {
        skipLink.classList.add('sr-only');
      });
      document.body.prepend(skipLink);

      // Enhanced focus management for modals
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const openModal = document.querySelector('dialog[open]');
          if (openModal) {
            const closeBtn = openModal.querySelector('.modal-close');
            closeBtn?.click();
          }

          const openDrawer = document.querySelector('.drawer[aria-hidden="false"]');
          if (openDrawer) {
            const closeBtn = openDrawer.querySelector('[data-close-drawer]');
            closeBtn?.click();
          }
        }
      });

      // Announce dynamic content changes
      const announcer = document.createElement('div');
      announcer.setAttribute('aria-live', 'polite');
      announcer.setAttribute('aria-atomic', 'true');
      announcer.className = 'sr-only';
      announcer.id = 'announcer';
      document.body.appendChild(announcer);

      window.announce = (message) => {
        announcer.textContent = message;
        setTimeout(() => announcer.textContent = '', 1000);
      };
    })();

    // Performance optimization
    (function initPerformanceOptimizations() {
      // Reduced motion support
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        document.documentElement.classList.add('reduce-motion');
      }

      // Connection-aware loading
      if ('connection' in navigator) {
        const connection = navigator.connection;
        if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
          document.documentElement.classList.add('performance-mode');
        }
      }

      // Intersection observer for lazy loading
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              if (img.dataset.src) {
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
                imageObserver.unobserve(img);
              }
            }
          });
        });

        // Observe images as they're added
        const observeImages = () => {
          document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
          });
        };

        observeImages();
      }
    })();
  </script>

  <noscript>
    <div style="padding: 2rem; text-align: center; background: var(--surface-primary); margin: 2rem; border-radius: var(--radius);">
      <h2>JavaScript Required</h2>
      <p>Please enable JavaScript to use the router filtering and comparison features.</p>
    </div>
  </noscript>
</body>
</html>
